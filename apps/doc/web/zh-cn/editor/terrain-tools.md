# 地形编辑

地形编辑器用于在场景中创建、修改和美化地表，包括地形的高度起伏、地表纹理以及草地植被分布。

---

## 创建地形

- 主菜单项选择`Add → Terrain`，然后将地形放置在场景中合适的位置。
- 属性面板中调整地形的分辨率（通常应匹配高度图的分辨率）。

<video src="https://cdn.zephyr3d.org/doc/assets/videos/create-terrain.mp4" controls width="640">
  您的浏览器不支持 video 标签。
</video>

---

## 地形笔刷

地形笔刷用于对地形进行所见即所得的绘制，包括高度修改、纹理涂抹以及草地种植。
在使用任何笔刷之前，请：

- 在场景中选中要编辑的地形；
- 点击工具栏中的编辑按钮，调出地形编辑面板；

**通用笔刷参数**

所有类型的笔刷通常都包含一些通用参数：

- 笔刷形状：可在形状列表中选择。
- 笔刷大小：影响作用范围，数值越大，影响区域越宽。
- 笔刷角度：影响笔刷作用在地形上的旋转角度。
- 笔刷强度：影响每次涂抹的力度，数值越大，变化越明显。

> 操作提示：按住鼠标左键在地形上拖动即可绘制。

### 高度笔刷

高度笔刷用于塑造山丘、河谷、平台等地形起伏。

**高度笔刷模式**：

- 抬高(Raise)：连续增加地形高度。
- 降低(Lower)：连续减少地形高度。
- 平滑(Smooth)：柔和地形细节，消除尖锐的高度变化。
- 平整到高度(flatten)：将四周地形高度拉平到笔刷所在位置的地形高度。
- 热力侵蚀(thermal erosion)：模拟碎石下滑导致的山体「钝化」。
- 水力侵蚀(hydraulic erosion)：模拟水流冲刷、搬运与沉积形成的沟壑与河谷。

<video src="https://cdn.zephyr3d.org/doc/assets/videos/height-brush.mp4" controls width="640">
  您的浏览器不支持 video 标签。
</video>

### 纹理笔刷

纹理笔刷用于在地形表面「涂抹」不同的地表材质，比如：土、草、石头、雪等

1. **地形着色原理**

引擎在渲染地形时，通常会用到两类纹理数据：

  - 细节纹理（Detail Map）：
    - 直接贴在地表上的「真实图案」，比如一块草地的草叶、泥地的颗粒、石头的裂缝。
    - 会在地表上按一定比例重复平铺，用来表现近距离观察时的细节质感。
    - 一般一类地表材质对应一张漫反射贴图和法线贴图等。
  - 混合权重纹理（Splat Map）：
    - 可以理解为「控制哪一块地面用哪种细节纹理」的权重贴图。
    - 利用 RGBA 四个通道：
      - R 通道控制「纹理 A」在地面的权重；
      - G 通道控制「纹理 B」；
      - B 通道控制「纹理 C」；
      - A 通道控制「纹理 D」。
    - 每个像素点的RGBA值决定了该位置4种纹理的混合比例。
    - 纹理笔刷本质上就是在编辑这些 Splat 纹理的通道值。

2. **准备细节纹理**

在使用笔刷绘制地表纹理之前需要添加细节纹理（目前引擎支持单个地形最多使用8张细节纹理）。

- 将细节纹理图片导入为资产；
- 在地形编辑面板中选择`texture`笔刷；
- 将细节漫反射纹理从资产视图拖放到`Detail Albedo`列表中；
- 将细节法线纹理从资产视图拖放到`Detail Normal`列表中（如果没有法线贴图可省略）；

3. **在地表上绘制纹理**

- 点击`Detail Albedo`列表中的某纹理；
- 调整合适的笔刷大小强度等参数；
- 在地形上使用鼠标绘制此纹理；

<video src="https://cdn.zephyr3d.org/doc/assets/videos/texture-brush.mp4" controls width="640">
  您的浏览器不支持 video 标签。
</video>

### 草地笔刷

草地笔刷用于在地形上批量种植草丛、野花等植被。

1. **准备草纹理**

在绘制草地之前需要添加草的纹理。

- 将草纹理图片导入为资产；
- 在地形面板中选择`grass`笔刷；
- 将草纹理从资产视图拖放到`Grass Textures`列表中；

2. **在地表上绘制草地**

- 点击`Grass Textures`中的某个草纹理；
- 调整合适的笔刷大小强度等参数；
- 在地形上使用鼠标绘制草地；

<video src="https://cdn.zephyr3d.org/doc/assets/videos/grass-brush.mp4" controls width="640">
  您的浏览器不支持 video 标签。
</video>

### 删除草地笔刷

如果草地刷的过于密集，可使用`erase grass`笔刷予以删除，操作方法和`grass`笔刷相同。
